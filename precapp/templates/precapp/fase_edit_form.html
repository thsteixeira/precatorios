<div class="card card-body m-2 bg-light">
    <form method="post" action="{% url 'editar_fase' fase.id %}">
        {% csrf_token %}
        
        <div class="row mb-3">
            <div class="col-12">
                <h6 class="text-primary mb-3">
                    <i class="fas fa-edit me-2"></i>Editar Fase: {{ fase.nome }}
                </h6>
            </div>
        </div>
        
        <div class="row">
            <!-- Nome Field -->
            <div class="col-md-3 mb-3">
                <label class="form-label">Nome da Fase <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="nome" value="{{ fase.nome }}" required>
            </div>
            
            <!-- Tipo Field -->
            <div class="col-md-3 mb-3">
                <label class="form-label">Tipo <span class="text-danger">*</span></label>
                <select class="form-control" name="tipo" required>
                    <option value="alvara" {% if fase.tipo == 'alvara' %}selected{% endif %}>Alvará</option>
                    <option value="requerimento" {% if fase.tipo == 'requerimento' %}selected{% endif %}>Requerimento</option>
                    <option value="ambos" {% if fase.tipo == 'ambos' %}selected{% endif %}>Ambos</option>
                </select>
            </div>
            
            <!-- Cor Field -->
            <div class="col-md-2 mb-3">
                <label class="form-label">Cor</label>
                <input type="color" class="form-control form-control-color" name="cor" value="{{ fase.cor }}">
            </div>
            
            <!-- Ordem Field -->
            <div class="col-md-2 mb-3">
                <label class="form-label">Ordem</label>
                <input type="number" class="form-control" name="ordem" min="0" value="{{ fase.ordem }}">
            </div>
        </div>
        
        <!-- Descrição Field (full width) -->
        <div class="row">
            <div class="col-12 mb-3">
                <label class="form-label">Descrição</label>
                <textarea class="form-control" name="descricao" rows="2" placeholder="Descrição opcional da fase">{{ fase.descricao }}</textarea>
            </div>
        </div>
        
        <div class="row">
            <!-- Ativa Field -->
            <div class="col-md-4 mb-3">
                <label class="form-label d-block">Status</label>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" name="ativa" id="ativa-{{ fase.id }}" {% if fase.ativa %}checked{% endif %}>
                    <label class="form-check-label" for="ativa-{{ fase.id }}">Fase Ativa</label>
                </div>
            </div>
            
            <!-- Actions -->
            <div class="col-md-8 mb-3 d-flex align-items-end">
                <div class="btn-group w-100" role="group">
                    <button type="submit" name="update_fase" class="btn btn-success btn-sm">
                        <i class="fas fa-save me-1"></i>Salvar
                    </button>
                    <button type="button" class="btn btn-warning btn-sm" 
                            onclick="toggleFaseStatus({{ fase.id }}, {{ fase.ativa|yesno:'false,true' }})">
                        <i class="fas fa-{% if fase.ativa %}pause{% else %}play{% endif %} me-1"></i>
                        {% if fase.ativa %}Desativar{% else %}Ativar{% endif %}
                    </button>
                    <button type="button" class="btn btn-danger btn-sm" 
                            data-bs-toggle="modal" 
                            data-bs-target="#deleteFaseModal-{{ fase.id }}" 
                            title="Excluir fase">
                        <i class="fas fa-trash me-1"></i>Excluir
                    </button>
                    <button type="button" class="btn btn-secondary btn-sm" 
                            data-bs-toggle="collapse" 
                            data-bs-target="#editFaseForm-{{ fase.id }}" 
                            title="Cancelar">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteFaseModal-{{ fase.id }}" tabindex="-1" aria-labelledby="deleteFaseLabel-{{ fase.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteFaseLabel-{{ fase.id }}">
                    <i class="fas fa-exclamation-triangle text-danger me-2"></i>Confirmar Exclusão
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir a fase <strong>"{{ fase.nome }}"</strong>?</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    <strong>Atenção:</strong> Esta ação não pode ser desfeita. 
                    Se existirem Alvarás ou Requerimentos usando esta fase, 
                    a exclusão será impedida.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancelar
                </button>
                <form method="post" action="{% url 'deletar_fase' fase.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>Excluir
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
